<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>관련 장소 지도에서 찾기</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=mc8mm4oocr&submodules=geocoder"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body style="text-align: center">
<h1> 동아대학교 S06 기준 </h1>
<div>
    <input type="text" id="keyword" placeholder="키워드 입력">
    <button onclick="searchPlace()">검색</button>
</div>

<div id="map" style="width:75%;height:400px; margin:0 auto;"></div>
<script>
    // 초기 좌표 설정 (동아대학교 S06 기준)
    var coordinates = new naver.maps.LatLng(35.11719379721626, 128.96776005910738);

    // 지도 옵션 설정
    var mapOptions = {
        center: coordinates, // 초기 중심 좌표
        zoom: 12 // 초기 확대 수준
    };

    // 지도를 생성하고 초기화
    var map = new naver.maps.Map('map', mapOptions);

    // 초기 마커 추가
    var marker = new naver.maps.Marker({
        position: coordinates, // 마커 위치
        map: map, // 마커를 표시할 지도
        title: '동아대학교 S06' // 마커 제목
    });

    // 장소 검색 함수
    function searchPlace() {
        var keyword = document.getElementById('keyword').value; // 입력된 키워드를 가져옴

        // 키워드가 비어 있는 경우 경고 메시지 출력
        if (keyword.trim() === "") {
            alert("키워드를 입력하세요.");
            return;
        }
        
        // 프록시 서버를 통해 네이버 API를 사용하여 장소 검색
        $.ajax({
            url: "http://localhost:3000/search", // 프록시 서버 URL
            type: "GET", // 요청 방식
            dataType: "json", // 응답 데이터 타입
            data: {
                keyword: keyword // 검색할 키워드
            },
            success: function(data) {
                alert(JSON.stringify(data)); // 응답 데이터 확인 
                // 검색 결과가 있는 경우
                if (data.items.length > 0) {
                    var item = data.items[0]; // 첫 번째 결과 아이템을 가져옴
                    var point = new naver.maps.Point(item.mapx, item.mapy); // TM128 좌표계의 x, y 좌표
                    var coordinates = naver.maps.TransCoord.fromTM128ToLatLng(point); // TM128 좌표를 WGS84 좌표로 변환
                    
                    map.setCenter(coordinates); // 지도의 중심을 새로운 좌표로 설정
                    marker.setPosition(coordinates); // 마커의 위치를 새로운 좌표로 설정
                    marker.setTitle(item.title.replace(/<[^>]*>/g, '')); // HTML 태그를 제거한 제목을 마커의 제목으로 설정
                } else {
                    alert("검색 결과가 없습니다."); // 검색 결과가 없는 경우 경고 메시지 출력
                }
            },
            error: function(error) {
                console.error("Error:", error);
                alert("장소 검색에 실패했습니다."); // API 호출 실패 시 경고 메시지 출력
            }
        });
    }
</script>
</body>
</html>
